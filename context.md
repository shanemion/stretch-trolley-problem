# Stretch Robot – Project Context (CS334) ## Hardware & Environment - Robot: **Hello Robot Stretch 3** - OS: Ubuntu 22.04 (onboard robot computer) - User account: `cs334` - Access method: primarily **SSH** from laptop - Desktop monitor exists but is **not required** for current scripts - Working directory: `~/student_code/smion/` - Repo: `~/student_code/smion/stretch_trolley/stretch-trolley-problem/` --- ## Python Setup (Already Done / Correct) - Using a virtual environment that can see system packages: ```bash python3 -m venv .venv --system-site-packages source .venv/bin/activate ``` - This is required because `stretch_body` is **system-installed** and is not visible in a normal isolated venv. Installed/working packages in practice: - `stretch_body` (system-installed on robot) - `numpy` - `opencv-python` - `ultralytics` - `pyrealsense2` --- ## Shell Aliases (Configured and Working) Aliases added to `~/.bashrc`: ```bash alias python='python3' alias free='stretch_free_robot_process.py' alias home='stretch_robot_home.py' alias stow='stretch_robot_stow.py' alias gamepad='stretch_gamepad_teleop.py' ``` These are used to reduce friction during iteration. --- ## Stretch Locking / “Another process is already using Stretch” - Only **one** process can control Stretch hardware at a time. - Common error: ```text Another process is already using Stretch. Try running "stretch_free_robot_process.py" ``` ### What happened in this project - Even after running `free`, `home` still failed. - Root cause was a lingering process: - `python3 look_at_human.py` was still running and re-acquiring the lock. - Diagnosis used: ```bash ps aux | grep -E "stretch_|stretch_body|robot|teleop|gamepad|realsense|python" | grep -v grep ``` - Fix was to kill the offending PID, then run: ```bash free ``` --- ## GUI vs SSH (Important Constraint) - SSH sessions have **no display** by default. - GUI/OpenCV scripts over SSH can fail with: ```text qt.qpa.xcb: could not connect to display Could not load the Qt platform plugin "xcb" ... ``` - This was encountered running `look_at_human.py` over SSH. - Solution: run GUI scripts on the robot desktop, or use headless scripts (no `cv2.imshow`). Current work is **headless** (console logging / motion only). --- ## Stretch Body API Facts (Validated in This Setup) ### Startup / Shutdown ```python import stretch_body.robot as robot r = robot.Robot() r.startup() r.stop() ``` ### Homing - Homing is necessary before reliable motion. - In this project, `r.home()` is used as the simplest reliable “calibrate everything” call: ```python r.home() ``` --- ## Arm Control (Prismatic, meters) - Arm moves in **meters**: ```python INCH = 0.0254 r.arm.move_by(5 * INCH) # extend 5 inches r.push_command() r.wait_command() ``` --- ## Gripper Control (Critical Correction) - Gripper is a Dynamixel servo and uses: ```python r.end_of_arm.move_to("stretch_gripper", value) ``` - Valid range per official docs: - `-100` = fully closed - `+100` = fully open This correction fixed earlier issues where commands used meter-like values (e.g., `0.07`) and “did nothing”. --- ## Gripper Status (if needed) ```python j = r.end_of_arm.get_joint("stretch_gripper") pos = j.status.get("pos") effort = j.status.get("effort", j.status.get("current")) ``` Notes: - `effort/current` may be missing or `None` depending on robot config. - Gentle closes are therefore implemented via **positional stepping**, not force sensing. --- ## Verified Working Behavior (Current State) A combined script is confirmed working: Sequence: 1. `startup()` 2. `home()` 3. Open gripper (`move_to(..., 100)`) 4. Extend arm 5 inches 5. Close gripper (gentle step-down toward closed) 6. Retract arm 5 inches while closed 7. Open gripper (`move_to(..., 100)`) 8. `stop()` This runs **headless over SSH**. --- ## Failures Encountered and Resolutions ### 1) `ModuleNotFoundError: numpy` - Cause: venv didn’t have numpy. - Fix: `pip install numpy ...` ### 2) `ModuleNotFoundError: stretch_body` - Cause: venv isolation prevented access to system-installed Stretch library. - Fix: recreate venv with: ```bash python3 -m venv .venv --system-site-packages ``` ### 3) `qt.qpa.xcb: could not connect to display` - Cause: GUI script run over SSH. - Fix: run on robot desktop or use headless scripts. ### 4) “Another process is already using Stretch” even after `free` - Cause: a script like `look_at_human.py` still running and holding/reacquiring the lock. - Fix: locate PID with `ps aux`, kill it, then `free`. ### 5) Gripper “open()” convenience method not available - Cause: `r.end_of_arm.open()` not supported on this setup. - Fix: use `r.end_of_arm.move_to("stretch_gripper", 100)`. --- ## Official Documentation Used - Writing code / startup / robot object: https://docs.hello-robot.com/0.3/getting_started/writing_code/ - Motion commands and joint APIs: https://docs.hello-robot.com/0.3/python/moving/ - Thread safety notes: https://github.com/hello-robot/stretch_body/blob/master/docs/is_thread_safe/README.md --- ## Current Goal - Build reliable headless behaviors combining perception + motion. - Keep scripts minimal, avoid GUI unless needed. - Respect Stretch’s single-controller locking model.